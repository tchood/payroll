
require_relative '../ni'

describe NICalculator do 
	before do
		@ni_test_data = [['W', 1, 'A', 155.04, 0, 0],
		['W', 1, 'A', 155.05, 0.01, 0],
		['W', 1, 'A', 156.04, 0.12, 0],
		['W', 1, 'A', 156.05, 0.13, 0.01],
		['W', 1, 'A', 827.04, 80.64, 92.6],
		['W', 1, 'A', 827.05, 80.64, 92.61],
		['W', 1, 'A', 827.29, 80.64, 92.64],
		['W', 1, 'A', 827.3, 80.65, 92.64],
		['W', 1, 'A', 1180, 87.7, 141.31],
		['W', 1, 'B', 155.1, 0, 0],
		['W', 1, 'B', 155.11, 0.01, 0],
		['W', 1, 'B', 156.04, 0.06, 0],
		['W', 1, 'B', 156.05, 0.06, 0.01],
		['W', 1, 'B', 827.04, 39.31, 92.6],
		['W', 1, 'B', 827.05, 39.31, 92.61],
		['W', 1, 'B', 827.29, 39.31, 92.64],
		['W', 1, 'B', 827.3, 39.32, 92.64],
		['W', 1, 'B', 1180, 46.37, 141.31],
		['W', 1, 'C', 156.04, 0, 0],
		['W', 1, 'C', 156.05, 0, 0.01],
		['W', 1, 'C', 827.04, 0, 92.6],
		['W', 1, 'C', 827.05, 0, 92.61],
		['W', 1, 'C', 1180, 0, 141.31],
		['W', 1, 'H', 155.04, 0, 0],
		['W', 1, 'H', 155.05, 0.01, 0],
		['W', 1, 'H', 827.04, 80.64, 0],
		['W', 1, 'H', 827.05, 80.64, 0.01],
		['W', 1, 'H', 827.29, 80.64, 0.04],
		['W', 1, 'H', 827.3, 80.65, 0.04],
		['W', 1, 'H', 1180, 87.7, 48.71],
		['W', 1, 'J', 155.29, 0, 0],
		['W', 1, 'J', 155.3, 0.01, 0],
		['W', 1, 'J', 156.04, 0.02, 0],
		['W', 1, 'J', 156.05, 0.02, 0.01],
		['W', 1, 'J', 827.04, 13.44, 92.6],
		['W', 1, 'J', 827.05, 13.44, 92.61],
		['W', 1, 'J', 827.29, 13.44, 92.64],
		['W', 1, 'J', 827.3, 13.45, 92.64],
		['W', 1, 'J', 1180, 20.5, 141.31],
		['W', 1, 'M', 155.04, 0, 0],
		['W', 1, 'M', 155.05, 0.01, 0],
		['W', 1, 'M', 827.04, 80.64, 0],
		['W', 1, 'M', 827.05, 80.64, 0.01],
		['W', 1, 'M', 827.29, 80.64, 0.04],
		['W', 1, 'M', 827.3, 80.65, 0.04],
		['W', 1, 'M', 1180, 87.7, 48.71],
		['W', 1, 'Z', 155.29, 0, 0],
		['W', 1, 'Z', 155.3, 0.01, 0],
		['W', 1, 'Z', 827.04, 13.44, 0],
		['W', 1, 'Z', 827.05, 13.44, 0.01],
		['W', 1, 'Z', 827.29, 13.44, 0.04],
		['W', 1, 'Z', 827.3, 13.45, 0.04],
		['W', 1, 'Z', 1180, 20.5, 48.71],
		['W', 2, 'A', 310.04, 0, 0],
		['W', 2, 'A', 310.05, 0.01, 0],
		['W', 2, 'A', 312.04, 0.24, 0],
		['W', 2, 'A', 312.05, 0.25, 0.01],
		['W', 2, 'A', 1654.04, 161.28, 185.2],
		['W', 2, 'A', 1654.05, 161.28, 185.21],
		['W', 2, 'A', 1654.29, 161.28, 185.24],
		['W', 2, 'A', 1654.3, 161.29, 185.24],
		['W', 2, 'A', 2545, 179.1, 308.16],
		['W', 2, 'B', 310.1, 0, 0],
		['W', 2, 'B', 310.11, 0.01, 0],
		['W', 2, 'B', 312.04, 0.12, 0],
		['W', 2, 'B', 312.05, 0.12, 0.01],
		['W', 2, 'B', 1654.04, 78.63, 185.2],
		['W', 2, 'B', 1654.05, 78.63, 185.21],
		['W', 2, 'B', 1654.29, 78.63, 185.24],
		['W', 2, 'B', 1654.3, 78.64, 185.24],
		['W', 2, 'B', 2545, 96.45, 308.16],
		['W', 2, 'C', 312.04, 0, 0],
		['W', 2, 'C', 312.05, 0, 0.01],
		['W', 2, 'C', 1654.04, 0, 185.2],
		['W', 2, 'C', 1654.05, 0, 185.21],
		['W', 2, 'C', 2545, 0, 308.16],
		['W', 2, 'H', 310.04, 0, 0],
		['W', 2, 'H', 310.05, 0.01, 0],
		['W', 2, 'H', 1654.04, 161.28, 0],
		['W', 2, 'H', 1654.05, 161.28, 0.01],
		['W', 2, 'H', 1654.29, 161.28, 0.04],
		['W', 2, 'H', 1654.3, 161.29, 0.04],
		['W', 2, 'H', 2545, 179.1, 122.96],
		['W', 2, 'J', 310.29, 0, 0],
		['W', 2, 'J', 310.3, 0.01, 0],
		['W', 2, 'J', 312.04, 0.04, 0],
		['W', 2, 'J', 312.05, 0.04, 0.01],
		['W', 2, 'J', 1654.04, 26.88, 185.2],
		['W', 2, 'J', 1654.05, 26.88, 185.21],
		['W', 2, 'J', 1654.29, 26.88, 185.24],
		['W', 2, 'J', 1654.3, 26.89, 185.24],
		['W', 2, 'J', 2545, 44.7, 308.16],
		['W', 2, 'M', 310.04, 0, 0],
		['W', 2, 'M', 310.05, 0.01, 0],
		['W', 2, 'M', 1654.04, 161.28, 0],
		['W', 2, 'M', 1654.05, 161.28, 0.01],
		['W', 2, 'M', 1654.29, 161.28, 0.04],
		['W', 2, 'M', 1654.3, 161.29, 0.04],
		['W', 2, 'M', 2545, 179.1, 122.96],
		['W', 2, 'Z', 310.29, 0, 0],
		['W', 2, 'Z', 310.3, 0.01, 0],
		['W', 2, 'Z', 1654.04, 26.88, 0],
		['W', 2, 'Z', 1654.05, 26.88, 0.01],
		['W', 2, 'Z', 1654.29, 26.88, 0.04],
		['W', 2, 'Z', 1654.3, 26.89, 0.04],
		['W', 2, 'Z', 2545, 44.7, 122.96],
		['W', 4, 'A', 620.04, 0, 0],
		['W', 4, 'A', 620.05, 0.01, 0],
		['W', 4, 'A', 624.04, 0.48, 0],
		['W', 4, 'A', 624.05, 0.49, 0.01],
		['W', 4, 'A', 3308.04, 322.56, 370.39],
		['W', 4, 'A', 3308.05, 322.56, 370.4],
		['W', 4, 'A', 3308.29, 322.56, 370.43],
		['W', 4, 'A', 3308.3, 322.57, 370.43],
		['W', 4, 'A', 4850, 353.4, 583.19],
		['W', 4, 'B', 620.1, 0, 0],
		['W', 4, 'B', 620.11, 0.01, 0],
		['W', 4, 'B', 624.04, 0.23, 0],
		['W', 4, 'B', 624.05, 0.23, 0.01],
		['W', 4, 'B', 3308.04, 157.24, 370.39],
		['W', 4, 'B', 3308.05, 157.24, 370.4],
		['W', 4, 'B', 3308.29, 157.24, 370.43],
		['W', 4, 'B', 3308.3, 157.25, 370.43],
		['W', 4, 'B', 4850, 188.08, 583.19],
		['W', 4, 'C', 624.04, 0, 0],
		['W', 4, 'C', 624.05, 0, 0.01],
		['W', 4, 'C', 3308.04, 0, 370.39],
		['W', 4, 'C', 3308.05, 0, 370.4],
		['W', 4, 'C', 4850, 0, 583.19],
		['W', 4, 'H', 620.04, 0, 0],
		['W', 4, 'H', 620.05, 0.01, 0],
		['W', 4, 'H', 3308.04, 322.56, 0],
		['W', 4, 'H', 3308.05, 322.56, 0.01],
		['W', 4, 'H', 3308.29, 322.56, 0.04],
		['W', 4, 'H', 3308.3, 322.57, 0.04],
		['W', 4, 'H', 4850, 353.4, 212.8],
		['W', 4, 'J', 620.29, 0, 0],
		['W', 4, 'J', 620.3, 0.01, 0],
		['W', 4, 'J', 624.04, 0.08, 0],
		['W', 4, 'J', 624.05, 0.08, 0.01],
		['W', 4, 'J', 3308.04, 53.76, 370.39],
		['W', 4, 'J', 3308.05, 53.76, 370.4],
		['W', 4, 'J', 3308.29, 53.76, 370.43],
		['W', 4, 'J', 3308.3, 53.77, 370.43],
		['W', 4, 'J', 4850, 84.6, 583.19],
		['W', 4, 'M', 620.04, 0, 0],
		['W', 4, 'M', 620.05, 0.01, 0],
		['W', 4, 'M', 3308.04, 322.56, 0],
		['W', 4, 'M', 3308.05, 322.56, 0.01],
		['W', 4, 'M', 3308.29, 322.56, 0.04],
		['W', 4, 'M', 3308.3, 322.57, 0.04],
		['W', 4, 'M', 4850, 353.4, 212.8],
		['W', 4, 'Z', 620.29, 0, 0],
		['W', 4, 'Z', 620.3, 0.01, 0],
		['W', 4, 'Z', 3308.04, 53.76, 0],
		['W', 4, 'Z', 3308.05, 53.76, 0.01],
		['W', 4, 'Z', 3308.29, 53.76, 0.04],
		['W', 4, 'Z', 3308.3, 53.77, 0.04],
		['W', 4, 'Z', 4850, 84.6, 212.8],
		['M', 1, 'A', 672.04, 0, 0],
		['M', 1, 'A', 672.05, 0.01, 0],
		['M', 1, 'A', 676.04, 0.48, 0],
		['M', 1, 'A', 676.05, 0.49, 0.01],
		['M', 1, 'A', 3583.04, 349.32, 401.17],
		['M', 1, 'A', 3583.05, 349.32, 401.18],
		['M', 1, 'A', 3583.29, 349.32, 401.21],
		['M', 1, 'A', 3583.3, 349.33, 401.21],
		['M', 1, 'A', 5500, 387.66, 665.72],
		['M', 1, 'B', 672.1, 0, 0],
		['M', 1, 'B', 672.11, 0.01, 0],
		['M', 1, 'B', 676.04, 0.23, 0],
		['M', 1, 'B', 676.05, 0.23, 0.01],
		['M', 1, 'B', 3583.04, 170.29, 401.17],
		['M', 1, 'B', 3583.05, 170.29, 401.18],
		['M', 1, 'B', 3583.29, 170.29, 401.21],
		['M', 1, 'B', 3583.3, 170.3, 401.21],
		['M', 1, 'B', 5500, 208.63, 665.72],
		['M', 1, 'C', 676.04, 0, 0],
		['M', 1, 'C', 676.05, 0, 0.01],
		['M', 1, 'C', 3583.04, 0, 401.17],
		['M', 1, 'C', 3583.05, 0, 401.18],
		['M', 1, 'C', 5500, 0, 665.72],
		['M', 1, 'H', 672.04, 0, 0],
		['M', 1, 'H', 672.05, 0.01, 0],
		['M', 1, 'H', 3583.04, 349.32, 0],
		['M', 1, 'H', 3583.05, 349.32, 0.01],
		['M', 1, 'H', 3583.29, 349.32, 0.04],
		['M', 1, 'H', 3583.3, 349.33, 0.04],
		['M', 1, 'H', 5500, 387.66, 264.55],
		['M', 1, 'J', 672.29, 0, 0],
		['M', 1, 'J', 672.3, 0.01, 0],
		['M', 1, 'J', 676.04, 0.08, 0],
		['M', 1, 'J', 676.05, 0.08, 0.01],
		['M', 1, 'J', 3583.04, 58.22, 401.17],
		['M', 1, 'J', 3583.05, 58.22, 401.18],
		['M', 1, 'J', 3583.29, 58.22, 401.21],
		['M', 1, 'J', 3583.3, 58.23, 401.21],
		['M', 1, 'J', 5500, 96.56, 665.72],
		['M', 1, 'M', 672.04, 0, 0],
		['M', 1, 'M', 672.05, 0.01, 0],
		['M', 1, 'M', 3583.04, 349.32, 0],
		['M', 1, 'M', 3583.05, 349.32, 0.01],
		['M', 1, 'M', 3583.29, 349.32, 0.04],
		['M', 1, 'M', 3583.3, 349.33, 0.04],
		['M', 1, 'M', 5500, 387.66, 264.55],
		['M', 1, 'Z', 672.29, 0, 0],
		['M', 1, 'Z', 672.3, 0.01, 0],
		['M', 1, 'Z', 3583.04, 58.22, 0],
		['M', 1, 'Z', 3583.05, 58.22, 0.01],
		['M', 1, 'Z', 3583.29, 58.22, 0.04],
		['M', 1, 'Z', 3583.3, 58.23, 0.04],
		['M', 1, 'Z', 5500, 96.56, 264.55]]
	end

	it "Should calculate NI according to HMRC test file" do
	@ni_test_data.each do |params|
			ni_calc = NICalculator.new(year_ending: '2017', annual_periods: params[0], pay_frequency: params[1], category_letter: params[2])
				expect(ni_calc.ees_ni_payable(params[3])).to eq params[4]
				expect(ni_calc.ers_ni_payable(params[3])).to eq params[5]
			end

		end
end